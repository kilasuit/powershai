---
external help file: powershai-help.xml
schema: 2.0.0
powershai: true
---

# Update-GradioApiResult

## SYNOPSIS <!--!= @#Synop !-->


## DESCRIPTION <!--!= @#Desc !-->
Updates an event returned by Send-GradioApi with new results from the server and, by default, returns the events in the pipeline.

The results of Gradio Apis are not generated instantly, as they are in most REST HTTP services.  
The Send-GradioApi command help explains in detail how the process works.  

This command should be used to update the GradioApiEvent object, returned by Send-GradioApi.
This object represents the response from each call you make to the API, it contains everything you need to query the result, including data and history.

Basically, this cmdlet works by invoking the Api invocation status query endpoint.
The parameters required for querying are available in the object itself passed in the -ApiEvent parameter (which is created and returned by the Send-GradioApi cmdlet)

Whenever this cmdlet runs, it communicates via a persistent HTTP connection to the server and waits for events.  
As the server sends the data, it updates the object passed in the -ApiEvent parameter, and, by default, writes the returned event to the pipeline.

The returned event is an object of type GradioApiEventResult, and represents an event generated by the response of the API execution.  

If the -History parameter is specified, all events generated are in the events property of the object provided in -ApiEvent, as well as the returned data.

Basically, the events generated can send a heartbeat or data.

GradioApiEventResult OBJECT
	num 	= sequential event number. starts at 1.
	ts 		= date the event was created (local date, not server).
	event 	= event name
	data 	= data returned in this event

DATA (DATA)

	Getting Gradio data is basically reading the events returned by this cmdlet and looking at the data property of the GradioApiEventResult
	Usually the Gradio interface overwrites the field with the last event received.  
	
	If -History is used, in addition to writing to the pipeline, the cmdlet will store the data in the data field, and therefore, you will have access to the complete history of what was generated by the server.  
	Note that this can cause additional memory consumption if a lot of data is returned.
	
	There is a known "problematic" case: eventually, gradio may emit the last 2 events with the same data (one event will have the name "generating", and the last will be complete).  
	We don't have a safe way to separate this yet, so the user has to decide the best way to proceed.  
	If you always use the last event received, this is not a problem.
	If you need to use all the events as they are being generated, you will have to handle these cases.
	A simple example would be to buy the content, if it were the same, don't repeat it. But there may be scenarios where 2 events with the same content are still logically different events.
	
	

HEARTBEAT 

	One of the events generated by the Gradio API are the Heartbeats.  
	Every 15 seconds, Gradio sends an event of type "HeartBeat", just to keep the connection active.  
	This causes the cmdlet to "hang", because, since the HTTP connection is active, it keeps waiting for a response (which will be data, errors or the heartbeat).
	
	If there is no mechanism to control this, the cmdlet would run indefinitely, without the possibility of canceling even with CTRL + C.
	To solve this, this cmdlet provides the MaxHeartBeats parameter.  
	This parameter indicates how many consecutive Heartbeat events will be tolerated before the cmdlet stops trying to query the API.  
	
	For example, consider these two scenarios of events sent by the server:
	
		scenario 1:
			generating 
			heartbeat 
			generating 
			heartbeat 
			generating 
			complete
			
		scenario 2:
			generating 
			generating
			heartbeat 
			heartbeat
			heartbeat 
			complete

	Considering the default value, 2, in scenario 1, the cmdlet would never end before complete, because there were never 2 consecutive heartbeats.
	
	Already in scenario 2, after receiving 2 data events (generating), in the fourth event (hearbeat), it would end, because 2 consecutive heartbeats were sent.  
	We say the heartbeat expired in this case.
	In this case, you should invoke Update-GradioApiResult again to get the rest.
	
	Whenever the command ends due to an expired heartbeat, it will update the LastQueryStatus property value to HeartBeatExpired.  
	With that, you can check and treat correctly when you should call again
	
	
STREAM  
	
	Due to the fact that the Gradio Api already responds using SSE (Server Side Events), it is possible to use an effect similar to the "stream" of many Apis.  
	This cmdlet, Update-GradioApiResult, already processes the server events using SSE.  
	Additionally, if you also want to do some processing as the event becomes available, you can use the -Script parameter and specify a scriptblock, functions, etc. that will be invoked as the event is received.  
	
	Combining with the -MaxHeartBeats parameter, you can create a call that updates something in real time. 
	For example, if it's a chatbot response, you can write to the screen immediately.
	
	note that this parameter is called in sequence with the code that checks (that is, same Thread).  
	Therefore, scripts that take a long time to execute can interfere with the detection of new events, and consequently, the delivery of data.
	
.

## SYNTAX <!--!= @#Syntax !-->

```
Update-GradioApiResult [[-ApiEvent] <Object>] [-Script <Object>] [-MaxHeartBeats <Object>] [-NoOutput] [-History] [<CommonParameters>]
```

## PARAMETERS <!--!= @#Params !-->

### -ApiEvent
Result of  Send-GradioApi

```yml
Parameter Set: (All)
Type: Object
Aliases: 
Accepted Values: 
Required: false
Position: 1
Default Value: 
Accept pipeline input: true (ByValue)
Accept wildcard characters: false
```

### -Script
script that will be invoked with each generated event!
Receives a hashtable with the following keys:
 	event - contains the generated event. event.event is the event name. event.data is the returned data.

```yml
Parameter Set: (All)
Type: Object
Aliases: 
Accepted Values: 
Required: false
Position: named
Default Value: 
Accept pipeline input: false
Accept wildcard characters: false
```

### -MaxHeartBeats
Max consecutive heartbeats until stop!
Causes the command to wait for only this number of consecutive heartbeats from the server.
When the server sends this amount, the cmdlet ends and sets the LastQueryStatus of the event to HeartBeatExpired

```yml
Parameter Set: (All)
Type: Object
Aliases: 
Accepted Values: 
Required: false
Position: named
Default Value: 
Accept pipeline input: false
Accept wildcard characters: false
```

### -NoOutput
Does not write the result to the cmdlet output

```yml
Parameter Set: (All)
Type: SwitchParameter
Aliases: 
Accepted Values: 
Required: false
Position: named
Default Value: False
Accept pipeline input: false
Accept wildcard characters: false
```

### -History
Keeps the history of events and data in the ApiEvent object
Note that this will consume more powershell memory!

```yml
Parameter Set: (All)
Type: SwitchParameter
Aliases: 
Accepted Values: 
Required: false
Position: named
Default Value: False
Accept pipeline input: false
Accept wildcard characters: false
```




<!--PowershaiAiDocBlockStart-->
_Automatically translated using PowershAI and AI_
<!--PowershaiAiDocBlockEnd-->
