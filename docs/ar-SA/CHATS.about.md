# الدردشات

# مقدمة <!--! @#Short -->

يحدد PowershAi مفهوم الدردشات، التي تساعد في إنشاء سجل وسياق للمحادثات!

# التفاصيل <!--! @#Long -->

يخلق PowershAi مفهوم الدردشات، التي تشبه كثيرًا مفهوم الدردشات في معظم خدمات LLM.

تسمح الدردشات بالتحدث مع خدمات LLM بطريقة معيارية، بغض النظر عن المزود الحالي.  
إنها توفر طريقة قياسية لهذه الوظائف:

- سجل الدردشات  
- السياق  
- خط الأنابيب (استخدام نتائج أوامر أخرى)  
- استدعاء الأدوات (تنفيذ الأوامر بناءً على طلب LLM)  

ليس جميع المزودين يطبقون دعم الدردشات.  
لمعرفة ما إذا كان المزود يدعم الدردشة، استخدم cmdlet Get-AiProviders، واستشر الخاصية "Chat". إذا كانت $true، فإن الدردشة مدعومة.  
ومع ذلك، بمجرد دعم الدردشة، قد لا تكون جميع الميزات مدعومة، بسبب قيود المزود.

## بدء دردشة جديدة

أبسط طريقة لبدء دردشة جديدة هي استخدام الأمر Send-PowershaiChat.  
بالطبع، يجب عليك استخدامه بعد إعداد المزود (باستخدام `Set-AiProvider`) والإعدادات الأولية، مثل المصادقة، إذا لزم الأمر.

```powershell
Send-PowershaiChat "مرحبًا، أنا أتحدث معك من Powershai"
```

لأغراض البساطة، يحتوي الأمر `Send-PowershaiChat` على اسم مستعار يسمى `ia` (اختصار للغة البرتغالية، الذكاء الاصطناعي).  
بهذا، يمكنك تقليل الكتابة والتركيز أكثر على الموجه:

```powershell
ia "مرحبًا، أنا أتحدث معك من Powershai"
```

تُرسل كل رسالة في دردشة. إذا لم تقم بإنشاء دردشة بشكل صريح، يتم استخدام دردشة خاصة تُسمى `default`.  
يمكنك إنشاء دردشة جديدة باستخدام `New-PowershaiChat`.

تمتلك كل دردشة سجلها الخاص من المحادثات والإعدادات. يمكن أن تحتوي على وظائفها الخاصة، إلخ.  
يمكن أن تكون إنشاء دردشات إضافية مفيدًا إذا كنت بحاجة إلى الحفاظ على أكثر من موضوع دون أن تختلط.

## أوامر الدردشة

الأوامر التي تتلاعب بالدردشات بطريقة أو بأخرى تكون في تنسيق `*-Powershai*Chat*`.  
بشكل عام، تقبل هذه الأوامر معلمة -ChatId، التي تسمح بتحديد اسم أو كائن الدردشة التي تم إنشاؤها باستخدام `New-PowershaiChat`.  
إذا لم يتم تحديده، فإنها تستخدم الدردشة النشطة.

## الدردشة النشطة

الدردشة النشطة هي الدردشة الافتراضية المستخدمة من قبل أوامر PowershaiChat.  
عندما يكون هناك دردشة واحدة فقط تم إنشاؤها، تعتبر دردشة نشطة.  
إذا كان لديك أكثر من دردشة نشطة، يمكنك استخدام الأمر `Set-PowershaiActiveChat` لتحديد أيها. يمكنك تمرير الاسم أو الكائن المرتجع بواسطة `New-PowershaiChat`.

## معلمات الدردشة

تمتلك كل دردشة بعض المعلمات التي تتحكم في جوانب متعددة.  
على سبيل المثال، الحد الأقصى من الرموز التي سيتم إرجاعها بواسطة LLM.

يمكن إضافة معلمات جديدة في كل إصدار من PowershAI.  
أسهل طريقة للحصول على المعلمات وما تفعله هي استخدام الأمر `Get-PowershaiChatParameter`؛  
سيجلب هذا الأمر قائمة بالمعلمات التي يمكن تكوينها، جنبًا إلى جنب مع القيمة الحالية ووصف كيفية استخدامها.  
يمكنك تغيير المعلمات باستخدام الأمر `Set-PowershaiChatParameter`.

بعض المعلمات المدرجة هي المعلمات المباشرة لواجهة برمجة التطبيقات للمزود. ستأتي مع وصف يشير إلى ذلك.

## السياق والسجل

تمتلك كل دردشة سياقًا وسجلًا.  
السجل هو كل سجل الرسائل المرسلة والمستلمة في المحادثة.  
حجم السياق هو مقدار السجل الذي سيتم إرساله إلى LLM، حتى يتذكر الردود.

لاحظ أن حجم السياق هو مفهوم في PowershAI، وليس هو نفسه "طول السياق" الذي يتم تعريفه في LLM.  
يؤثر حجم السياق فقط على Powershai، وبناءً على القيمة، قد يتجاوز طول السياق للمزود، مما قد يؤدي إلى أخطاء.  
من المهم الحفاظ على حجم السياق متوازنًا بين إبقاء LLM محدثًا بما تم قوله بالفعل وعدم تجاوز الحد الأقصى من الرموز لـ LLM.

يمكنك التحكم في حجم السياق من خلال معلمة الدردشة، أي باستخدام `Set-PowershaiChatParameter`.

لاحظ أن السجل والسياق يتم تخزينهما في ذاكرة الجلسة، أي إذا قمت بإغلاق جلسة Powershell الخاصة بك، فسيتم فقدانهما.  
في المستقبل، قد يكون لدينا آليات تسمح للمستخدم بحفظها تلقائيًا واستعادتها بين الجلسات.

أيضًا، من المهم أن نتذكر أنه بمجرد حفظ السجل في ذاكرة Powershell، يمكن أن تتسبب المحادثات الطويلة جدًا في تجاوز أو استهلاك مرتفع لذاكرة Powershell.  
يمكنك إعادة تعيين الدردشات في أي وقت باستخدام الأمر `Reset-PowershaiCurrentChat`، الذي سيحذف كل سجل الدردشة النشطة.  
استخدمه بحذر، لأن ذلك سيؤدي إلى فقدان كل السجل ولن يتذكر LLM الخصائص التي تم الإبلاغ عنها خلال المحادثة.

## خط الأنابيب

أحد أقوى ميزات دردشات Powershai هو التكامل مع خط أنابيب Powershell.  
أساسيًا، يمكنك تمرير نتيجة أي أمر Powershell وسيتم استخدامها كسياق.

يقوم PowershAI بذلك عن طريق تحويل الكائنات إلى نص وإرسالها في الموجه.  
ثم تُضاف رسالة الدردشة بعد ذلك.

على سبيل المثال:

```
Get-Service | ia "قم بتلخيص الخدمات التي ليست شائعة في Windows"
```

في الإعدادات الافتراضية لـ Powershai، سيقوم الأمر `ia` (الاسم المستعار لـ `Send-PowershaiChat`) بالحصول على جميع الكائنات المرتجعة بواسطة `Get-Service` وتنسيقها كسلسلة نصية عملاقة واحدة.  
ثم، ستُحقن هذه السلسلة في موجه LLM، وسيتم إرشاده لاستخدام هذه النتيجة كسياق لموجه المستخدم.

يتم تجميع موجه المستخدم بعد ذلك مباشرة.

بهذا، يتم إنشاء تأثير قوي: يمكنك بسهولة دمج مخرجات الأوامر مع الموجهات الخاصة بك، باستخدام أنابيب بسيطة، وهي عملية شائعة في Powershell.  
يميل LLM إلى اعتبار ذلك جيدًا.

على الرغم من وجود قيمة افتراضية، لديك السيطرة الكاملة على كيفية إرسال هذه الكائنات.  
الطريقة الأولى للتحكم هي كيفية تحويل الكائن إلى نص. نظرًا لأن الموجه هو سلسلة نصية، من الضروري تحويل هذا الكائن إلى نص.  
بشكل افتراضي، يتم تحويله إلى تمثيل قياسي لـ Powershell، وفقًا لنوعه (باستخدام الأمر `Out-String`).  
يمكنك تغيير ذلك باستخدام الأمر `Set-PowershaiChatContextFormatter`. يمكنك تحديد، على سبيل المثال، JSON، جدول، وحتى نص برمجي مخصص للحصول على تحكم كامل.

الطريقة الأخرى للتحكم في كيفية إرسال السياق هي باستخدام معلمة الدردشة `ContextFormat`.  
تتحكم هذه المعلمة في الرسالة الكاملة التي سيتم حقنها في الموجه. إنها كتلة نص برمجي.  
يجب عليك إرجاع مصفوفة من السلاسل، والتي تعادل الموجه المرسل.  
تتمتع هذه الكتلة النصية بالوصول إلى معلمات مثل الكائن المنسق الذي يتم تمريره في خط الأنابيب، وقيم معلمات الأمر Send-PowershaiChat، إلخ.  
القيمة الافتراضية للنص البرمجي هي مشفرة، ويجب عليك التحقق مباشرة في الكود لمعرفة كيفية إرسالها (وللحصول على مثال حول كيفية تنفيذ نصك الخاص).

### الأدوات

إحدى الميزات الكبيرة المطبقة هي دعم استدعاء الوظائف (أو استدعاء الأدوات).  
تتيح هذه الميزة، المتاحة في العديد من LLMs، للذكاء الاصطناعي اتخاذ قرار استدعاء الوظائف لجلب بيانات إضافية في الرد.  
بشكل أساسي، تصف واحدة أو أكثر من الوظائف ومعلماتها، ويمكن للنموذج أن يقرر استدعاءها.**مهم: يمكنك استخدام هذه الميزة فقط مع مقدمي الخدمة الذين يقدمون استدعاء الوظائف باستخدام نفس مواصفات OpenAI**

لمزيد من التفاصيل، راجع الوثائق الرسمية لـ OpenAI حول استدعاء الوظائف: [استدعاء الوظائف](https://platform.openai.com/docs/guides/function-calling).

النموذج يقرر فقط أي الوظائف يتم استدعاؤها، ومتى يتم استدعاؤها ومعلماتها. يتم تنفيذ هذا الاستدعاء بواسطة العميل، في حالتنا، PowershAI.  
تتوقع النماذج تعريف الوظائف من خلال وصف ما تفعله، ومعلماتها، ونتائجها، إلخ. يتم القيام بذلك في الأصل باستخدام شيء مثل OpenAPI Spec لوصف الوظائف.  
ومع ذلك، يحتوي PowerShell على نظام مساعدة قوي باستخدام التعليقات، والذي يسمح بوصف الوظائف ومعلماتها، بالإضافة إلى أنواع البيانات.  

يتكامل PowershAI مع هذا النظام للمساعدة، مترجماً إياه إلى مواصفات OpenAPI. يمكن للمستخدم كتابة وظائفه بشكل طبيعي، باستخدام التعليقات لتوثيقها ويتم إرسال ذلك إلى النموذج.  

لتوضيح هذه الميزة، دعنا نذهب إلى برنامج تعليمي بسيط: أنشئ ملفًا يسمى `MinhasFuncoes.ps1` بالمحتوى التالي

```powershell
# ملف MinhasFuncoes.ps1، احفظه في أي دليل تفضله!

<#
    .DESCRIPTION
    يسرد الوقت الحالي
#>
function HoraAtual {
    return Get-Date
}

<#
    .DESCRIPTION
    يحصل على رقم عشوائي!
#>
function NumeroAleatorio {
    param(
        # الرقم الأدنى
        $Min = $null,
        
        # الرقم الأقصى
        $Max = $null
    )
    return Get-Random -Min $Min -Max $Max
}
```
**لاحظ استخدام التعليقات لوصف الوظائف والمعلمات**.  
هذه هي صيغة مدعومة بواسطة PowerShell، والمعروفة باسم [مساعدة مستندة إلى التعليقات](https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_comment_based_help?view=powershell-7.4).

الآن، دعنا نضيف هذا الملف إلى PowershAI:

```powershell
import-module powershai 

Set-AiProvider openai 
Set-OpenaiToken #قم بتكوين الرمز المميز إذا لم يتم تكوينه بعد.


# أضف البرنامج النصي كأدوات!
# على افتراض أن البرنامج النصي تم حفظه في C:\tempo\MinhasFuncoes.ps1
Add-AiTool C:\tempo\MinhasFuncoes.ps1

# تأكد من إضافة الأدوات 
Get-AiTool
```

جرّب أن تطلب من النموذج ما هو التاريخ الحالي أو اطلب منه توليد رقم عشوائي! سترى أنه سينفذ وظائفك! هذا يفتح إمكانيات لا حصر لها، وإبداعك هو الحد!

```powershell
ia "كم الساعة؟"
```

في الأمر أعلاه، سيقوم النموذج باستدعاء الوظيفة. على الشاشة سترى الوظيفة يتم استدعاؤها!  
يمكنك إضافة أي أمر أو نص برمجي لـ PowerShell كأداة.  
استخدم الأمر `Get-Help -Full Add-AiTol` لمزيد من التفاصيل حول كيفية استخدام هذه الوظيفة القوية.

يتولى PowershAI تلقائيًا تنفيذ الأوامر وإرسال الرد مرة أخرى إلى النموذج.  
إذا قرر النموذج تنفيذ عدة وظائف في وقت واحد، أو أصر على تنفيذ وظائف جديدة، فسيدير PowershAI ذلك تلقائيًا.  
لاحظ أنه، لتجنب حلقة لا نهائية من التنفيذ، يفرض PowershAI حدًا على الحد الأقصى من التنفيذات.  
المعلمة التي تتحكم في هذه التفاعلات مع النموذج هي `MaxInteractions`.  

#### اعتبارات مهمة حول استخدام الأدوات

ميزة استدعاء الوظائف قوية لأنها تسمح بتنفيذ التعليمات البرمجية، لكنها أيضًا خطيرة، خطيرة جدًا.  
لذلك، كن حذرًا للغاية بشأن ما تقوم بتنفيذه وتشغيله.  
تذكر أن PowershAI سينفذ وفقًا لما يطلبه النموذج.

بعض نصائح الأمان:

- تجنب تشغيل البرنامج النصي مع مستخدم مسؤول.
- تجنب تنفيذ التعليمات البرمجية التي تحذف أو تعدل بيانات مهمة.
- اختبر الوظائف مسبقًا.
- لا تتضمن وحدات أو نصوص برمجية من جهات خارجية لا تعرفها أو لا تثق بها.  


_تمت الترجمة تلقائيًا باستخدام PowershAI و IA_
